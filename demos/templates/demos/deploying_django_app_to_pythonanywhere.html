{# demos/templates/demos/deploying_django_app_to_pythonanywhere.html #}
{% extends 'portfolio/base.html' %}
{% load static %}

{% block title %}{{ page_title|default:"Deploying Django to PythonAnywhere" }} - Portfolio{% endblock %}
{% block meta_description %}{{ meta_description|default:"Step-by-step guide for deploying Django applications to PythonAnywhere.com." }}{% endblock %}
{% block meta_keywords %}{{ meta_keywords|default:"Django, PythonAnywhere, Deployment, Guide, Python, WSGI, Hosting" }}{% endblock %}

{% block content %}
<div class="container mx-auto px-6 py-12">

    <header class="mb-10 text-center">
        {# Gradient heading #}
        <h1 class="text-4xl md:text-5xl font-bold mb-4 bg-gradient-to-r from-green-500 via-lime-500 to-yellow-500 dark:from-green-400 dark:via-lime-400 dark:to-yellow-400 bg-clip-text text-transparent">
            {{ page_title|default:"Deploying Django to PythonAnywhere" }}
        </h1>
        <p class="text-lg text-gray-600 dark:text-gray-400">A step-by-step guide to get your Django app live on PythonAnywhere.com.</p>
    </header>

    <main class="max-w-4xl mx-auto bg-white dark:bg-gray-800 p-6 md:p-8 rounded-lg shadow-lg dark:shadow-lime-900/20 transition-colors duration-300 ease-in-out">
        {# Use prose for overall text formatting #}
        <div class="prose prose-indigo dark:prose-invert lg:prose-lg max-w-none text-gray-700 dark:text-gray-300 leading-relaxed space-y-8">

            <section id="prerequisites">
                <h2 class="!text-2xl !font-semibold !border-b !border-gray-300 dark:!border-gray-700 !pb-2 !mb-4 text-gray-800 dark:text-gray-100">1. Prerequisites</h2>
                <ul class="!list-disc !list-inside !space-y-2 !pl-4">
                    <li>A working Django project.</li>
                    <li>A `requirements.txt` file listing all dependencies (generate with <code>pip freeze > requirements.txt</code>).</li>
                    <li>A <a href="https://www.pythonanywhere.com/registration/register/beginner/" target="_blank" rel="noopener noreferrer">PythonAnywhere account</a> (Free "Beginner" tier available).</li>
                    <li>Your code available via Git (GitHub, GitLab, Bitbucket) OR ready to upload as a zip file.</li>
                    <li>Basic familiarity with the Linux command line (used in PythonAnywhere consoles).</li>
                </ul>
            </section>

            <section id="upload-project">
                <h2 class="!text-2xl !font-semibold !border-b !border-gray-300 dark:!border-gray-700 !pb-2 !mb-4 text-gray-800 dark:text-gray-100">2. Upload Your Project</h2>
                <p>Get your code onto PythonAnywhere's servers.</p>

                <div class="space-y-6">
                    <div>
                        <h3 class="!text-xl !font-semibold !mb-2">Option A: Using Git (Recommended)</h3>
                        <ol class="!list-decimal !list-inside !space-y-2 !pl-4">
                            <li>Open a "Bash Console" from the PythonAnywhere "Consoles" tab.</li>
                            <li>Clone your repository:
                                <pre><code class="language-bash">git clone https://github.com/yourusername/your-repo-name.git</code></pre>
                                <p class="!text-xs !mt-1">(Replace with your actual repository URL).</p>
                            </li>
                            <li>Your code will now be in a directory named `your-repo-name` inside your PythonAnywhere home directory (`/home/yourusername/`).</li>
                        </ol>
                    </div>

                    <div>
                        <h3 class="!text-xl !font-semibold !mb-2">Option B: Uploading a Zip File</h3>
                         <ol class="!list-decimal !list-inside !space-y-2 !pl-4">
                            <li>Zip your entire project directory locally.</li>
                            <li>Go to the "Files" tab on PythonAnywhere.</li>
                            <li>Navigate to the directory where you want your project (usually your home directory).</li>
                            <li>Use the "Upload a file" button to upload your zip file.</li>
                            <li>Open a "Bash Console".</li>
                            <li>Unzip the file:
                                <pre><code class="language-bash">unzip your_project.zip</code></pre>
                            </li>
                        </ol>
                    </div>
                </div>
                 <p class="!text-sm !mt-4">Assume your project code is now located at `/home/yourusername/your-repo-name/`. Remember this path.</p>
            </section>

            <section id="virtualenv">
                <h2 class="!text-2xl !font-semibold !border-b !border-gray-300 dark:!border-gray-700 !pb-2 !mb-4 text-gray-800 dark:text-gray-100">3. Set Up Virtual Environment</h2>
                <p>Create and configure a virtual environment for your project on PythonAnywhere.</p>
                 <ol class="!list-decimal !list-inside !space-y-2 !pl-4">
                    <li>In your Bash Console, navigate *outside* your project directory (optional, but common practice).</li>
                    <li>Create the virtual environment using a specific Python version (check PythonAnywhere's available versions):
                        <pre><code class="language-bash">mkvirtualenv --python=/usr/bin/python3.10 myenv</code></pre>
                        <p class="!text-xs !mt-1">Replace `python3.10` with your desired version and `myenv` with your preferred environment name. This automatically activates the environment.</p>
                    </li>
                    <li>Navigate into your project directory:
                        <pre><code class="language-bash">cd /home/yourusername/your-repo-name/</code></pre>
                        <p class="!text-xs !mt-1">(Use `workon myenv` if you need to reactivate the virtualenv later).</p>
                    </li>
                    <li>Install dependencies from your `requirements.txt`:
                         <pre><code class="language-bash">pip install -r requirements.txt</code></pre>
                    </li>
                    <li>Remember the full path to your virtual environment. It's usually `/home/yourusername/.virtualenvs/myenv`. Find it using `which python` while the environment is active.</li>
                </ol>
            </section>

            <section id="web-app-setup">
                <h2 class="!text-2xl !font-semibold !border-b !border-gray-300 dark:!border-gray-700 !pb-2 !mb-4 text-gray-800 dark:text-gray-100">4. Configure the Web App</h2>
                <p>Use the PythonAnywhere web interface to set up the web application.</p>
                 <ol class="!list-decimal !list-inside !space-y-3 !pl-4">
                    <li>Go to the "Web" tab on your PythonAnywhere dashboard.</li>
                    <li>Click "Add a new web app".</li>
                    <li>Follow the prompts:
                        <ul class="!list-disc !list-inside !space-y-1 !mt-2 !pl-4 !text-sm">
                            <li>Your domain name will be `yourusername.pythonanywhere.com` (unless using a custom domain).</li>
                            <li>Select "Manual configuration" (<strong>Important:</strong> Do NOT select the "Django" option here as it sets up a new default project).</li>
                            <li>Choose the Python version matching your virtual environment (e.g., Python 3.10).</li>
                        </ul>
                    </li>
                    <li>After creation, scroll down to the "Code" section:
                         <ul class="!list-disc !list-inside !space-y-1 !mt-2 !pl-4 !text-sm">
                            <li><strong>Source code:</strong> Enter the full path to your project's directory (e.g., `/home/yourusername/your-repo-name/`).</li>
                            <li><strong>Working directory:</strong> Usually the same as the source code path.</li>
                         </ul>
                    </li>
                    <li>Scroll down to the "Virtualenv" section:
                         <ul class="!list-disc !list-inside !space-y-1 !mt-2 !pl-4 !text-sm">
                            <li>Enter the full path to your virtual environment (e.g., `/home/yourusername/.virtualenvs/myenv`).</li>
                         </ul>
                    </li>
                     <li>Find the "WSGI configuration file" link (usually near the top of the "Code" section) and click the path to edit it.</li>
                 </ol>
            </section>

            <section id="wsgi-config">
                <h2 class="!text-2xl !font-semibold !border-b !border-gray-300 dark:!border-gray-700 !pb-2 !mb-4 text-gray-800 dark:text-gray-100">5. Edit the WSGI Configuration File</h2>
                <p>Modify the WSGI file provided by PythonAnywhere to point to your Django application.</p>
                <p class="!text-sm">The file path will be something like `/var/www/yourusername_pythonanywhere_com_wsgi.py`.</p>
                <p class="!text-sm">Edit the file in the PythonAnywhere editor. Delete most of the default content and replace it with the Django-specific configuration below:</p>
                <pre><code class="language-python">
import os
import sys

# Add your project directory to the sys.path
# Replace 'yourusername' and 'your-repo-name'
path = '/home/yourusername/your-repo-name'
if path not in sys.path:
    sys.path.insert(0, path)

# Add your project's parent directory IF your settings.py is inside a subdirectory
# e.g., if settings.py is in /home/yourusername/your-repo-name/myproject/
# project_path = '/home/yourusername/your-repo-name/myproject'
# if project_path not in sys.path:
#    sys.path.insert(0, project_path)

# Set the DJANGO_SETTINGS_MODULE environment variable
# Replace 'your_project_name' with the name of the directory containing settings.py
os.environ['DJANGO_SETTINGS_MODULE'] = 'your_project_name.settings'

# Import the Django WSGI application handler
from django.core.wsgi import get_wsgi_application
application = get_wsgi_application()
                </code></pre>
                <p class="!text-xs !mt-2">
                    Replace placeholders (`yourusername`, `your-repo-name`, `your_project_name`) with your actual values.
                </p>
                <p class="!text-sm !mt-2"><strong>Save the file</strong> using the editor's save button.</p>
            </section>

             <section id="django-settings-db">
                <h2 class="!text-2xl !font-semibold !border-b !border-gray-300 dark:!border-gray-700 !pb-2 !mb-4 text-gray-800 dark:text-gray-100">6. Django Settings & Database</h2>
                 <p>Adjust your `settings.py` and set up the database.</p>
                 <ul class="!list-disc !list-inside !space-y-3 !pl-4">
                    <li>
                        <strong>ALLOWED_HOSTS:</strong> In your `settings.py` (edit via Files tab or console), add your PythonAnywhere domain:
                        <pre><code class="language-python">
# settings.py
ALLOWED_HOSTS = ['yourusername.pythonanywhere.com']
# Add 'www.yourcustomdomain.com' if using a custom domain
                        </code></pre>
                    </li>
                     <li>
                        <strong>DEBUG:</strong> Ensure `DEBUG = False` in `settings.py` for production.
                    </li>
                     <li>
                        <strong>SECRET_KEY:</strong> Load from an environment variable (see Section 8). Ensure it's not hardcoded if possible.
                    </li>
                    <li>
                        <strong>Database Setup:</strong>
                        <ul class="!list-disc !list-inside !space-y-2 !mt-2 !pl-4 !text-sm">
                            <li><strong>SQLite (Default/Free Tier):</strong> Usually works out-of-the-box. The `db.sqlite3` file will reside in your project directory.</li>
                            <li><strong>MySQL/PostgreSQL (Paid Accounts):</strong> Go to the "Databases" tab on PythonAnywhere to create a database. Note the connection details (hostname, username, password, database name) provided there. Update your `settings.py` `DATABASES` dictionary. Install drivers (`mysqlclient` or `psycopg2-binary`) in your virtualenv.</li>
                        </ul>
                    </li>
                     <li>
                        <strong>Run Migrations:</strong> Open a Bash console, activate your virtualenv (`workon myenv`), navigate to your project directory (`cd /home/yourusername/your-repo-name/`), and run:
                        <pre><code class="language-bash">python manage.py migrate</code></pre>
                    </li>
                     <li>
                        <strong>Create Superuser (Optional):</strong>
                        <pre><code class="language-bash">python manage.py createsuperuser</code></pre>
                    </li>
                </ul>
            </section>

            <section id="static-files">
                <h2 class="!text-2xl !font-semibold !border-b !border-gray-300 dark:!border-gray-700 !pb-2 !mb-4 text-gray-800 dark:text-gray-100">7. Configure Static Files</h2>
                <p>PythonAnywhere serves static files directly. Configure the mapping in the "Web" tab.</p>
                 <ol class="!list-decimal !list-inside !space-y-3 !pl-4">
                     <li>
                        Ensure `settings.py` defines `STATIC_URL` and `STATIC_ROOT`:
                        <pre><code class="language-python">
# settings.py
import os

STATIC_URL = '/static/'
# STATIC_ROOT should be an absolute path on PythonAnywhere servers
STATIC_ROOT = '/home/yourusername/your-repo-name/staticfiles' # Adjust path
                        </code></pre>
                        <p class="!text-xs !mt-1">Make sure `STATIC_ROOT` points to a directory *within* your allowed file storage area.</p>
                    </li>
                     <li>
                        Run `collectstatic` in your Bash console (with virtualenv activated):
                        <pre><code class="language-bash">python manage.py collectstatic --no-input</code></pre>
                        <p class="!text-xs !mt-1">This creates the `staticfiles` directory (or your `STATIC_ROOT` name).</p>
                    </li>
                    <li>
                        Go to the "Web" tab on PythonAnywhere. Scroll down to the "Static files" section.
                    </li>
                    <li>
                        Add a new static file mapping:
                        <ul class="!list-disc !list-inside !space-y-1 !mt-2 !pl-4 !text-sm">
                            <li><strong>URL:</strong> Enter `/static/` (matching `STATIC_URL`).</li>
                            <li><strong>Directory:</strong> Enter the full path to `STATIC_ROOT` (e.g., `/home/yourusername/your-repo-name/staticfiles/`).</li>
                        </ul>
                    </li>
                     <li>Repeat for `MEDIA_URL` and `MEDIA_ROOT` if handling user uploads. Map `MEDIA_URL` (e.g., `/media/`) to the full path of your `MEDIA_ROOT` (e.g., `/home/yourusername/your-repo-name/mediafiles/`).</li>
                 </ol>
                 <p class="!text-sm !mt-2">Note: WhiteNoise is generally *not* needed on PythonAnywhere.</p>
            </section>

             <section id="environment-variables">
                <h2 class="!text-2xl !font-semibold !border-b !border-gray-300 dark:!border-gray-700 !pb-2 !mb-4 text-gray-800 dark:text-gray-100">8. Environment Variables (Secrets)</h2>
                <p>Set sensitive information like `SECRET_KEY` or API keys securely.</p>

                <div class="space-y-6">
                    <div>
                        <h3 class="!text-xl !font-semibold !mb-2">Option A: Using the WSGI File (Simpler, Less Secure)</h3>
                        <p class="!text-sm">Set environment variables directly within your WSGI configuration file (before importing `get_wsgi_application`).</p>
                         <pre><code class="language-python">
# /var/www/yourusername_pythonanywhere_com_wsgi.py
# ... (sys.path modifications) ...

# Set environment variables
os.environ['SECRET_KEY'] = 'your_very_secret_production_key' # Replace!
os.environ['EMAIL_HOST_PASSWORD'] = 'your_email_password'
# ... add other variables ...

os.environ['DJANGO_SETTINGS_MODULE'] = 'your_project_name.settings'
# ... (import get_wsgi_application) ...
                        </code></pre>
                         <p class="!text-xs !mt-2"><strong>Security Note:</strong> Secrets are visible in the file. Ensure file permissions are restricted.</p>
                    </div>

                    <div>
                        <h3 class="!text-xl !font-semibold !mb-2">Option B: Using a `.env` File (Recommended)</h3>
                         <ol class="!list-decimal !list-inside !space-y-2 !pl-4">
                            <li>Install `python-dotenv` in your virtualenv: <code>pip install python-dotenv</code> (add to `requirements.txt`).</li>
                            <li>Create `.env` in your project root (`/home/yourusername/your-repo-name/.env`). Add secrets:
                                <pre><code class="language-text">
SECRET_KEY='your_very_secret_production_key'
DATABASE_URL='your_db_url_if_not_using_pa_db'
EMAIL_HOST_PASSWORD='your_email_password'
                                </code></pre>
                            </li>
                             <li>Modify `settings.py` to load `.env` early:
                                <pre><code class="language-python">
# settings.py
from pathlib import Path
import os
from dotenv import load_dotenv

BASE_DIR = Path(__file__).resolve().parent.parent
# Load environment variables from .env file in project root
load_dotenv(os.path.join(BASE_DIR, '.env'))

SECRET_KEY = os.environ.get('SECRET_KEY')
# ... other settings using os.environ.get() ...
                                </code></pre>
                            </li>
                            <li>Modify your WSGI file to load `.env` *before* setting `DJANGO_SETTINGS_MODULE`:
                                 <pre><code class="language-python">
# /var/www/yourusername_pythonanywhere_com_wsgi.py
import os
import sys
from dotenv import load_dotenv # Import

# Add project path to sys.path
path = '/home/yourusername/your-repo-name'
if path not in sys.path:
    sys.path.insert(0, path)

# Load .env file from project directory
project_folder = path # Use the defined path
load_dotenv(os.path.join(project_folder, '.env')) # Add this line

os.environ['DJANGO_SETTINGS_MODULE'] = 'your_project_name.settings'

from django.core.wsgi import get_wsgi_application
application = get_wsgi_application()
                                </code></pre>
                            </li>
                            <li><strong>Important:</strong> Add `.env` to your `.gitignore` file locally.</li>
                        </ol>
                    </div>
                </div>
            </section>

            <section id="reload">
                <h2 class="!text-2xl !font-semibold !border-b !border-gray-300 dark:!border-gray-700 !pb-2 !mb-4 text-gray-800 dark:text-gray-100">9. Reload Web App</h2>
                 <ol class="!list-decimal !list-inside !space-y-3 !pl-4">
                    <li>After making changes to your code (via `git pull` or re-uploading), WSGI file, virtualenv, or static file mappings, go to the "Web" tab on PythonAnywhere.</li>
                    <li>Click the big green "Reload yourusername.pythonanywhere.com" button. This applies your changes.</li>
                    <li>Visit your site at `http://yourusername.pythonanywhere.com` to check if it's working!</li>
                 </ol>
            </section>

            <section id="troubleshooting">
                <h2 class="!text-2xl !font-semibold !border-b !border-gray-300 dark:!border-gray-700 !pb-2 !mb-4 text-gray-800 dark:text-gray-100">10. Troubleshooting</h2>
                <p>Check these logs (found in the "Web" tab under "Log files") if you encounter errors:</p>
                <ul class="!list-disc !list-inside !space-y-2 !pl-4">
                    <li><strong>Error Log:</strong> Shows errors from your Django application code (exceptions, tracebacks).</li>
                    <li><strong>Server Log:</strong> Shows messages from the server infrastructure (WSGI startup, process management).</li>
                    <li><strong>Access Log:</strong> Records incoming HTTP requests.</li>
                    <li><strong>Common Issues:</strong>
                        <ul class="!list-disc !list-inside !space-y-1 !mt-2 !pl-4 !text-sm">
                            <li>Incorrect paths in WSGI file (`sys.path`, `DJANGO_SETTINGS_MODULE`).</li>
                            <li>Virtual environment path incorrect in "Web" tab or environment not activated in console.</li>
                            <li>Missing dependencies in `requirements.txt` / virtualenv.</li>
                            <li>Incorrect static file URL/Directory mapping in "Web" tab.</li>
                            <li>`STATIC_ROOT` in `settings.py` not matching the Directory path in the Web tab.</li>
                            <li>Database connection errors (check credentials, hostname, DB name in `settings.py` or environment variables).</li>
                            <li>Syntax errors in `settings.py` or WSGI file.</li>
                            <li>Forgetting to "Reload" the web app after making changes.</li>
                        </ul>
                    </li>
                    <li>Consult the <a href="https://help.pythonanywhere.com/pages/DebuggingImportError/" target="_blank" rel="noopener noreferrer">PythonAnywhere Help Pages</a>, especially the "Debugging ImportError" guide.</li>
                </ul>
            </section>

        </div>{# End Prose #}
    </main>

    <div class="text-center mt-12">
        <a href="{% url 'portfolio:index' %}" class="text-blue-600 dark:text-blue-400 hover:underline focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-900 rounded">&larr; Back to Home</a>
    </div>

</div>
{% endblock %}
