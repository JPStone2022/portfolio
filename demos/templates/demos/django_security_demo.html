{# demos/templates/demos/django_security_demo.html #}
{% extends 'portfolio/base.html' %} {# Assumes base is in portfolio app #}
{% load static %}
{% load humanize %} {# Load if needed, e.g., for templatetag escaping #}

{% block title %}{{ page_title }} - Portfolio{% endblock %}
{% block meta_description %}{{ meta_description|default:"Learn about Django's built-in security features." }}{% endblock %}
{% block meta_keywords %}{{ meta_keywords|default:"Django, security, web framework, CSRF, XSS" }}{% endblock %}


{% block content %}
<div class="container mx-auto px-6 py-12">
    {# Apply gradient text to heading #}
    <h1 class="text-4xl md:text-5xl font-bold text-center mb-6 bg-gradient-to-r from-red-600 to-orange-600 dark:from-red-500 dark:to-orange-400 bg-clip-text text-transparent">
        {{ page_title }}
    </h1>
    <p class="text-center text-gray-600 dark:text-gray-400 max-w-3xl mx-auto mb-10">
        Building secure web applications is crucial. Django includes several built-in features to protect against common web vulnerabilities "out-of-the-box". Here's an overview of how Django helps keep this portfolio site secure:
    </p>

    {# Main content area #}
    <div class="max-w-4xl mx-auto bg-white dark:bg-gray-800 p-8 rounded-lg shadow-lg dark:shadow-orange-900/20 transition-colors duration-300 ease-in-out">

        {# --- CSRF Protection --- #}
        <section class="mb-8 pb-6 border-b border-gray-200 dark:border-gray-700">
            <h2 class="text-2xl font-semibold text-gray-800 dark:text-gray-100 mb-3">1. Cross-Site Request Forgery (CSRF) Protection</h2>
            <div class="prose prose-indigo dark:prose-invert max-w-none text-gray-700 dark:text-gray-300 leading-relaxed">
                <p><strong>What it is:</strong> An attack where a malicious website tricks a user's browser into making an unwanted request to your site while the user is logged in (e.g., submitting a form without the user's intent).</p>
                <p><strong>How Django Helps:</strong> Django's `CsrfViewMiddleware` (enabled by default in `settings.py`) works with the `{% templatetag openblock %} csrf_token {% templatetag closeblock %}` template tag.
                    <ul>
                        <li>A unique, secret token is generated for each user session.</li>
                        <li>The `{% templatetag openblock %} csrf_token {% templatetag closeblock %}` tag embeds this token in a hidden field within every POST form.</li>
                        <li>When the form is submitted, the middleware checks if the submitted token matches the one stored in the user's session. If they don't match or the token is missing, the request is rejected.</li>
                    </ul>
                </p>
                <p><strong>Importance for this Portfolio:</strong> Protects the Contact Form from being submitted maliciously by external sites on behalf of a logged-in user (if user accounts were enabled) or potentially used for spam relay if not properly secured.</p>
            </div>
             <div class="mt-4">
                <h4 class="text-sm font-medium text-gray-600 dark:text-gray-400 mb-1">Example (`template.html`):</h4>
                 <pre><code class="language-html">
&lt;form method="post"&gt;
    {% templatetag openblock %} csrf_token {% templatetag closeblock %} {# REQUIRED for POST forms #}
    {% templatetag openvariable %} form.as_p {% templatetag closevariable %} {# Render form fields as paragraphs #}
    &lt;button type="submit"&gt;Send&lt;/button&gt;
&lt;/form&gt;
                </code></pre>
            </div>
        </section>

        {# --- SQL Injection Prevention --- #}
        <section class="mb-8 pb-6 border-b border-gray-200 dark:border-gray-700">
            <h2 class="text-2xl font-semibold text-gray-800 dark:text-gray-100 mb-3">2. SQL Injection Prevention</h2>
            <div class="prose prose-indigo dark:prose-invert max-w-none text-gray-700 dark:text-gray-300 leading-relaxed">
                <p><strong>What it is:</strong> An attack where malicious SQL code is inserted into data entry fields (like a search box or form input) to manipulate the database (e.g., steal data, delete records).</p>
                <p><strong>How Django Helps:</strong> Django's <strong>ORM (Object-Relational Mapper)</strong> uses parameterized queries by default. When you use methods like `Model.objects.filter(name=user_input)` or `Model.objects.get(id=user_id)`, the ORM safely separates the query structure from the user-provided data. The database driver correctly escapes the input, preventing it from being interpreted as SQL code.</p>
                <p><strong>Importance for this Portfolio:</strong> Protects database queries generated by the Search feature, admin interface, and potentially any future features involving user input that interacts with the database, preventing data theft or corruption.</p>
            </div>
             <div class="mt-4">
                <h4 class="text-sm font-medium text-gray-600 dark:text-gray-400 mb-1">Example (`views.py` - Safe ORM Query):</h4>
                <pre><code class="language-python">
from .models import Project
from django.db.models import Q

def search_results_view(request):
    query = request.GET.get('q', '')
    results = Project.objects.none()
    if query:
        # Django ORM automatically parameterizes 'query'
        results = Project.objects.filter(
            Q(title__icontains=query) | Q(description__icontains=query)
        )
    # ... render template ...
                </code></pre>
            </div>
        </section>

        {# --- Cross-Site Scripting (XSS) Prevention --- #}
         <section class="mb-8 pb-6 border-b border-gray-200 dark:border-gray-700">
            <h2 class="text-2xl font-semibold text-gray-800 dark:text-gray-100 mb-3">3. Cross-Site Scripting (XSS) Prevention</h2>
            <div class="prose prose-indigo dark:prose-invert max-w-none text-gray-700 dark:text-gray-300 leading-relaxed">
                <p><strong>What it is:</strong> An attack where malicious scripts (usually JavaScript) are injected into content that is then displayed to other users. When the victim's browser renders the page, the malicious script executes, potentially stealing cookies/session information or performing actions on their behalf.</p>
                <p><strong>How Django Helps:</strong> Django's template engine automatically escapes HTML characters by default. When you display a variable like `{{ user_comment }}` in a template, characters like `<`, `>`, `&` are converted into their safe HTML entities (e.g., `&lt;`, `&gt;`, `&amp;`). This prevents any script tags or other potentially harmful HTML entered by one user from being executed by another user's browser.</p>
                <p><strong>Importance for this Portfolio:</strong> Protects against potential XSS if user-generated content were ever displayed (e.g., blog comments, future profile fields). Even displaying search queries (`{{ query }}`) benefits from this default protection.</p>
            </div>
             <div class="mt-4">
                <h4 class="text-sm font-medium text-gray-600 dark:text-gray-400 mb-1">Example (`template.html` - Auto-escaping):</h4>
                 {# Comments explaining the example are now OUTSIDE the pre block #}
                 <p class="text-xs italic text-gray-500 dark:text-gray-400 mt-1 mb-1">If project.description contained <code>&lt;script&gt;alert('XSS')&lt;/script&gt;</code>, rendering it normally...</p>
                 <pre><code class="language-html">
&lt;p&gt;{% templatetag openvariable %} project.description {% templatetag closevariable %}&lt;/p&gt;
                </code></pre>
                 <p class="text-xs italic text-gray-500 dark:text-gray-400 mt-1 mb-3">...would output the following safe HTML, preventing the script from running:</p>
                 <pre><code class="language-html">
&lt;p&gt;&amp;lt;script&amp;gt;alert(&amp;#x27;XSS&amp;#x27;)&amp;lt;/script&amp;gt;&lt;/p&gt;
                </code></pre>
                 <p class="text-xs italic text-gray-500 dark:text-gray-400 mt-3 mb-1">To intentionally render HTML (use with extreme caution only on fully trusted data):</p>
                 <pre><code class="language-html">
{% templatetag openvariable %} trusted_html_content|safe {% templatetag closevariable %}
                </code></pre>
            </div>
        </section>

         {# --- Other Protections --- #}
         <section>
            <h2 class="text-2xl font-semibold text-gray-800 dark:text-gray-100 mb-3">4. Other Security Features</h2>
            <div class="prose prose-indigo dark:prose-invert max-w-none text-gray-700 dark:text-gray-300 leading-relaxed">
                <ul>
                    <li><strong>Clickjacking Protection:</strong> Prevents malicious sites from loading your site in an invisible frame to trick users into clicking things (`XFrameOptionsMiddleware`).</li>
                    <li><strong>Password Hashing:</strong> Stores user passwords securely using strong hashing algorithms (like PBKDF2 or Argon2) by default, making them very difficult to reverse engineer even if the database is compromised.</li>
                    <li><strong>HTTPS/SSL Support:</strong> While configuration happens at the web server/hosting level, Django provides settings (`SECURE_SSL_REDIRECT`, `SESSION_COOKIE_SECURE`, `CSRF_COOKIE_SECURE`) to enforce secure connections.</li>
                </ul>
                <p>By leveraging these built-in features, Django provides a strong security foundation, reducing the risk of common web vulnerabilities for applications like this portfolio.</p>
            </div>
        </section>

    </div>

</div>

 <div class="text-center mt-12">
    <a href="{% url 'portfolio:index' %}" class="text-blue-600 dark:text-blue-400 hover:underline focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-900 rounded">&larr; Back to Home</a>
</div>
</div>
{% endblock %}
